<html>

  <head>
    <title>INFO 3300 - Project 1</title>
    <!--- D3 IMPORT HERE --->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!--- D3 IMPORT HERE --->

    <style>
      .gridlines line {
        stroke: #bbb;
      }
      .gridlines .domain {
        stroke: none;
      }
    </style>

  </head>

  <body>
    <h3>Project 1</h3>

    <svg id="svg" height="500" width="500"> </svg>

    <p id ="visualization1">
      <h3><b> Visualization #1: Scatterplot </b></h3>

      <script>
        // Loading the dataset
        var dataset;

        d3.csv('ElectricCarData_Clean.csv').then( (data) => {
          dataset = data;

          // Scatterplot Setup
          const svg = d3.select('svg');
          const width = svg.attr('width');
          const height = svg.attr('height');
          const margins = {top: 10, right: 10, bottom: 100, left: 100};
          const chartWidth = width - margins.left - margins.right;
          const chartHeight = height - margins.top - margins.bottom;

          // Extents and Respective Scales
          const efficiencyExtent = d3.extent(data, d => parseInt(d['Efficiency_WhKm']) );
          const xScale = d3.scaleLog().domain(efficiencyExtent).range([0, chartWidth]);

          const priceExtent = d3.extent(data, d => parseInt(d['PriceEuro']) );
          const yScale = d3.scaleLinear().domain(priceExtent).range([chartHeight, 0]);

          // Plot points
          svg.selectAll("circle").data(data)
             .join("circle")
             .attr("cx", d => xScale(d['Efficiency_WhKm']) )
             .attr("cy", d => yScale(d['PriceEuro']) )
             .attr("r", 5)
             .attr("fill", "lightblue");

         // Initialize Y-Axis g Tag
         let xAxis = d3.axisBottom(xScale);
         svg.append('g')
             .attr('class', 'y axis')
             .attr('transform',`translate(${margins.left},${chartHeight+margins.top+10})`)
             .call(xAxis);

           // Initialize Y-Axis g Tag
           let yAxis = d3.axisLeft(yScale);
           svg.append('g')
             .attr('class', 'y axis')
             .attr('transform',`translate(${margins.left-10},${margins.top})`)
             .call(yAxis);

            // X-axis label
            svg.append("text")
              .attr("class", "x label")
              .attr("text-anchor", "center")
              .attr("x", width/2)
              .attr("y", height - 10)
              .text("Efficiency (WhKm)");

            // Y-axis label
            svg.append("text")
              .attr("class", "y label")
              .attr("text-anchor", "end")
              .attr("x", -chartWidth/2)
              .attr("y", 30)
              .attr("transform", "rotate(-90)")
             .text("Price (in euros)");

        }); // End of promise
      </script>
    </p>


    <p id ="visualization2">
      <h3><b> Visualization #2: Luxury Vehicle Performance Circle Chart </b></h3>

      <svg id="lux" height="500" width="1000"> </svg>

      <script>
        // Loading the dataset
        var dataset;

        d3.csv('ElectricCarData_Clean.csv').then( (data) => { // Begin promise
          dataset = data;
          console.log(data);

          // Visualization Constants Setup
          const svg_lux = d3.select('svg#lux');
          const width = svg_lux.attr('width');
          const height = svg_lux.attr('height');
          const margins = {top: 10, right: 10, bottom: 150, left: 100};
          const chartWidth = width - margins.left - margins.right;
          const chartHeight = height - margins.top - margins.bottom;

          // Filter Dataset for Luxury Vehicles
          let lux_cars = data.filter(function(d) {return d.Segment == "F";})

          // Create New Column "Brand_Model" - Combine the Brand and Model names for labeling clarity on vis
          lux_cars.forEach( (d, i) => {
            d["Brand_Model"] = d["Brand"]+d["Model"];
          });

          console.log(lux_cars);

          // Extents and Scales Setup
          // Y-axis is going to consist of AccelSec, TopSpeed_KmH, PriceEuro, Range_Km
          const accelerationExtent = d3.extent(data, d => parseInt(d['AccelSec']));
          const acceleration_Scale = d3.scaleLinear().domain(accelerationExtent).range([1, 50]);

          const topSpeedExtent = d3.extent(data, d => parseInt(d['TopSpeed_KmH']));
          const topSpeed_Scale = d3.scaleLinear().domain(topSpeedExtent).range([1, 50]);

          const priceExtent = d3.extent(data, d => parseInt(d['PriceEuro']));
          const price_Scale = d3.scaleLinear().domain(priceExtent).range([1, 50]);

          const rangeExtent = d3.extent(data, d => parseInt(d['Range_Km']));
          const range_Scale = d3.scaleLinear().domain(rangeExtent).range([1, 50]);

          // Y Scale
          //const y_Scale = d3.scaleLinear().domain([1, 4]).range([chartHeight, 0]);
          const y_Scale = d3.scaleBand().domain(["AccelSec", "TopSpeed_KmH", "PriceEuro", "Range_Km"])
                                         .range([chartHeight, 0]);

          const brand_models = d3.map(lux_cars, d => d.Brand_Model);
          const carScale = d3.scaleBand().domain(brand_models).range([0, chartWidth-10]);


          // PARENT CHART G TAGS INITIALIZATION
          let annotations = svg_lux.append("g").attr("id", "annotations"); // All labels and gridlines
          let chartArea = svg_lux.append("g")
                                 .attr("id", "points")
                                 .attr("transform",`translate(${margins.left}, ${margins.top})`); // All vis content

          // Initialize g Tag for X-Axis and Add Labels
          let bottomAxis = d3.axisBottom().scale(carScale);
          annotations.append("g")
                     .attr("class", "x axis")
                     .attr("transform",`translate(${margins.left}, ${chartHeight+margins.top+30})`)
                     .call(bottomAxis)
                     .selectAll("text")
                     .attr("transform", "rotate(-90)")
                     .style("text-anchor", "end");
          let bottomGridlines = d3.axisBottom(carScale)
                                  .tickSize(-chartHeight-10)
                                  .tickFormat("")
          annotations.append("g")
                     .attr("class", "x gridlines")
                     .attr("transform",`translate(${margins.left}, ${chartHeight+margins.top+10})`)
                     .call(bottomGridlines);

          // Intialize g Tag for Y-Axis and Add Labels
          let leftAxis = d3.axisLeft(y_Scale); // Will need to change to include all in future!
          let leftGridlines = d3.axisLeft(y_Scale)
                                .tickSize(-chartWidth-10)
                                .tickFormat("");
          annotations.append("g")
                     .attr("class", "y axis")
                     .attr("transform",`translate(${margins.left-10},${margins.top})`)
                     .call(leftAxis);
          // annotations.append("g")
          //            .attr("class", "y gridlines")
          //            .attr("transform",`translate(${margins.left-10},${margins.top})`)
          //            .call(leftGridlines);

          let circles= chartArea.selectAll('g.circle').data(lux_cars)
                                .join("g")
                                .attr("class", "circle");
                                //.style("stroke", d => acceleration_Scale(d.AccelSec));

          circles.append("g").selectAll("g.circle").data(lux_cars)
                 .join("circle")
                 .attr("cx", d => carScale(d.Brand_Model) + (carScale.bandwidth()/2))
                 .attr("cy",
                            //y_Scale(["AccelSec", "TopSpeed_KmH", "PriceEuro", "Range_Km"]) + y_Scale.bandwidth()/2)
                            y_Scale("AccelSec") + y_Scale.bandwidth()/2)
                 .attr("r", d => acceleration_Scale(d.AccelSec))
                 .style("fill",  "purple");
        }); // End of promise



      </script>
    </p>

  </body>


</html>
