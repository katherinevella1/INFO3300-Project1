<html>

  <head>
    <title>INFO 3300 - Project 1</title>
    <!--- D3 IMPORT HERE --->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!--- D3 IMPORT HERE --->

  </head>

  <body>
    <h3>Project 1</h3>

    <svg id="svg" height="500" width="500"> </svg>

    <p id ="visualization1">
      <h3><b> Visualization #1 </b></h3>

      <script>
        // Loading the dataset
        var dataset;

        d3.csv('ElectricCarData_Clean.csv').then( (data) => {
          dataset = data;
          console.log(data);

          const svg = d3.select('svg');
          const width = svg.attr('width');
          const height = svg.attr('height');
          const margins = {top: 10, right: 10, bottom: 100, left: 100};
          const chartWidth = width - margins.left - margins.right;
          const chartHeight = height - margins.top - margins.bottom;

          const efficiencyExtent = d3.extent(data, d => parseInt(d['Efficiency_WhKm']) );
          const xScale = d3.scaleLog().domain(efficiencyExtent).range([0, chartWidth]);

          const priceExtent = d3.extent(data, d => parseInt(d['PriceEuro']) );
          const yScale = d3.scaleLinear().domain(priceExtent).range([chartHeight, 0]);

          svg.selectAll("circle").data(data)
             .join("circle")
             .attr("cx", d => xScale(d['Efficiency_WhKm']) )
             .attr("cy", d => yScale(d['PriceEuro']) )
             .attr("r", 5)
             .attr("fill", "lightblue");

         let xAxis = d3.axisBottom(xScale);
         svg.append('g')
             .attr('class', 'y axis')
             .attr('transform',`translate(${margins.left},${chartHeight+margins.top+10})`)
             .call(xAxis);

           let yAxis = d3.axisLeft(yScale);
           svg.append('g')
             .attr('class', 'y axis')
             .attr('transform',`translate(${margins.left-10},${margins.top})`)
             .call(yAxis);

            // x axis label
            svg.append("text")
              .attr("class", "x label")
              .attr("text-anchor", "center")
              .attr("x", width/2)
              .attr("y", height - 10)
              .text("Efficiency (WhKm)");

            // y axis label
            svg.append("text")
              .attr("class", "y label")
              .attr("text-anchor", "end")
              .attr("x", -chartWidth/2)
              .attr("y", 30)
              .attr("transform", "rotate(-90)")
             .text("Price (in euros)");


        }); // end of promise


      </script>
    </p>

    <p id ="visualization2">
      <h3><b> Visualization #2 </b></h3>

      <svg id="lux" height="500" width="1000"> </svg>

      <script>

        // Loading the dataset
        var dataset;

        d3.csv('ElectricCarData_Clean.csv').then( (data) => {
          dataset = data;
          //console.log(data);

          const svg_lux = d3.select('svg#lux');
          const width = svg_lux.attr('width');
          const height = svg_lux.attr('height');
          const margins = {top: 10, right: 10, bottom: 100, left: 100};
          const chartWidth = width - margins.left - margins.right;
          const chartHeight = height - margins.top - margins.bottom;

          let lux_cars = data.filter(function(d) {return d.Segment == "F";})

          // creating new column "Brand_Model"
          lux_cars.forEach( (d, i) => {
            d["Brand_Model"] = d["Brand"]+d["Model"];
          });

          console.log(lux_cars);

          const accelerationExtent = d3.extent(data, d => parseInt(d['AccelSec']) );
          const acceleration_Scale = d3.scaleLinear().domain(accelerationExtent).range([0, 5]);

          const brand_models = d3.map(lux_cars, d => d.Brand_Model)
          const carScale = d3.scaleBand().domain(brand_models).range([0, chartWidth]);


          let bottomAxis = d3.axisBottom().scale(carScale);
          svg_lux.append("g")
               .attr("class", "x axis")
               .attr("transform",`translate(${margins.left},${chartHeight+margins.top})`)
               .call(bottomAxis)
            .selectAll("text")
              .attr("transform", "rotate(-90)")
              .style("text-anchor", "end");

          let chartArea = svg_lux.append("g").attr("id", "points")
                .attr("transform",`translate(${margins.left},${chartHeight+margins.top})`);

          chartArea.selectAll('rect.bar').data( lux_cars )
            .join('rect').attr('class','bar')
            .attr("fill", "steelblue")
            .attr("x", d => carScale(d.Brand_Model))
            .attr("y", d => 20)
            .attr("height", 20)
            .attr("width", 5);


        }); // end of promise



      </script>
    </p>

  </body>


</html>
